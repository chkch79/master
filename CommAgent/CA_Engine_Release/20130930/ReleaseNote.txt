Release info for Comm Agent
---------------------------
Version : V5.0.1.7
Release date : 12/09/2013

Enhancements:
1. Performance enhancement on CA direct comm module especially for big file downloading and uploading
2. Memory optimization for big file downloading and uploading


Version : V5.0.1.6
Release date : 16/02/2013

Enhancements:
1. Separate duplicated txn from failed txn.
   If in Appl.properties, IgnorePrimaryKeyViolationErrorInTxnProcess is set to True (deafult value is True), 
       CA will not store duplicated txn to FailedTxn folder
2. If KeepDuplicatedTxnInTxnProcess is set to True (default to True), 
       Duplicated txn will be kept to WorkDir/DuplicatedTxn folder
   If KeepDuplicatedTxnInTxnProcess is set to False, the duplicated txn will not be specially stored 
3. Fix issues in directcomm which works with the client engine version 7.0.1.3 and after:
   To handle the jump packet issue. i.e. receive N packet, then receive N+2 packet, return NAK and request packet N+1
   For message level error, CA will return NAK followed by closing the socket. (in previous version, CA only close the socket)

Version : V5.0.1.5
Release date : 16/10/2012

Enhancements:
1. Fix an issue in Tracks project, in the PurgeOldMasterData module, CA may enter a endless while-loop if ther is job assigned to this user
2. Support 
  . Call GetEncryptedString.bat to encrypte a string:
GetEncyptedString.bat  @pmiwel1

It may return imFbmldFrVXh3eyXxzOseQ==

  . Put the encrypted string in the appl.properties or XML file
ServerPassword=#ENCRYPTED:imFbmldFrVXh3eyXxzOseQ==#


Version : V5.0.1.4-TESTING-20120807
Release date : 07/08/2012

Enhancements:
1. Fix a issue in V5.0.1.4-TESTING-20120716:
When run CA as service, CA fails to send email alert because of exception: .\PropertiesConfig\Alert.properties (The system cannot find the path specified)

Version : V5.0.1.4-TESTING-20120726
Release date : 26/07/2012

Enhancements:
1. Fix the issue of master data downloading when the record number is more than 10,000


Version : V5.0.1.4-TESTING-20120716
Release date : 16/07/2012

Enhancements:
1. Support alert message for failed transaction, connection timeout and func call timeout

Define the following parameters in Alert.properties:

email.aunthentication=on
email.smtp.host=newspage.com.sg
email.smtp.port=25
email.userid=user1
email.password=pass1
email.sender=user1@newspage.com.sg

FailedTxn.email.alert=on
FailedTxn.email.recepients=user1@newspage.com.sg
FailedTxn.email.subject=Comm Agent Failed Transaction Alert

timeout.email.alert=on
timeout.email.recepients=user1@newspage.com.sg
timeout.email.subject=Comm Agent Timeout Alert


Highlight:
1. Need include JavaMail library mail.jar in Startup.bat, StartAdmin.bat and InstallService.bat

Version : V5.0.1.4-TESTING-20120713
Release date : 13/07/2012

Enhancements:
1. To download image/document stored in a column of table to mobile client in binary format for client to store as files
   Need specify the field Attribute to 'C' (column to file), for example, in the following example,
   the CA will package the value of DATA column as binary format

     <TableSync Name="DownloadDataAsFile" Method="Refresh" TableSyncMethod="SimplyOverwrite">
     <DataSrc Name="M_DOC" Type="JDBC" Format="DEFAULT" MaximumRecord="1">
     	 <Condition Value="DATA is not null" />
         <Field Name="FILE_NAME"></Field>
         <Field Name="DEVICE_PATH"></Field>
         <Field Name="DATA" Attribute="C" Type="Binary"></Field>
     </DataSrc>
     <DataDst Name="DOWNLOADFILE" Type="Client" Format="XML" Separator="\t">
         <Field Name="FILE_NAME" Type="varchar"></Field>
         <Field Name="DEVICE_PATH" Type="varchar"></Field>
         <Field Name="DATA" Type="varchar"></Field>
     </DataDst>
     </TableSync>

Version : V5.0.1.3
Release to : John
Release date : 27/06/2012

Enhancements:
1. Fix the issue with # in the incoming data from client
2. Fix the issue in directcomm, and the new release will reject a new connection with same device ID but different hardware ID

Version : V5.0.1.2
Release to : Thanmaya
Release date : 12/06/2012

Enhancements:
1. License enhancement: remove the device which has not been online for 2 days when license is fully occupied 
2. Add new before/after call <... Action="WriteFile" ..>, which will retrive data from database and save into a data file
3. Add the maximum size of outbound data message logged into log file: MaximumLoggedOutboundDataSize (in KB), data after this limit will not be logged into log file

Version : V5.0.1.1
Release to : Chian Hwa
Release date : 24/02/2012
Enhancements:
1. Fix a bug in HA environment, when inserting record into NP_LOCK table,
prevous CA engine inserted the module name wrongly

Version : V5.0.1.0-20110623
Release to : SPH
Release date : 23/06/2011
Enhancements:
1. Support session variable in the Condition of before/after call

I.e. <After ... Condition="Session:#UserValidationResult#" />
The after call will execute if the value of #UserValidationResult# is 1

Version : V5.0.1.0-20110504
Release to : QA,Pepsico
Release date : 04/05/2011
Enhancements:
1. Fix an issue of V5.0.1.0-20110314.V5.0.1.0-20110415 and V5.0.1.0-20110420

In the TableSync defintion with both the MaximumRecord and ZIP files set up in DataSrc,
The engine V5.0.1.0-20110314.V5.0.1.0-20110415 and V5.0.1.0-20110420 always put in the end of message 
rather than the beginning of release data. So it causes client
cannot interpret the release file correctly.

Version : V5.0.1.0-20110420
Release to : QA,SPH
Release date : 20/04/2011
Enhancements:
1. Fix the issue that CA engine only verify the frist 19 bytes of Hardware ID 

Version : V5.0.1.0-20110415
Release to : QA,SPH
Release date : 15/04/2011
Enhancements:
1. Add a new device authentication mode:  DeviceIDOnlyWithoutPasswordCheck, for this mode, CA only check Device ID in the low level comm module
You can turn on this by adding the following line into app.properties:

SupportDeviceAuthentication=True
DeviceAuthenticationMode=DeviceIDOnlyWithoutPasswordCheck


Version : V5.0.1.0-20110314
Release to : QA,SPH
Release date : 14/03/2011
Enhancements:
1. Reduce CA memory usage during preparing and downloading master data

Version : V5.0.1.0-20110222
Release to : QA,Chian Hwa,Jor Wei
Release date : 22/02/2011
Enhancements:
1. Detect and display device connection timeout
When device does not disconnect within a predefined threshold, CA will detect it and display this info in
a. In User tab of CA GUI
b. In CA exception report (a new report)
c. In Error.log (Need turn on it by adding SupportErrorLogFile=True in appl.properties)
Such as: Device connection time exceeeds predefined threshold, device ID: NP002,connected at 2011-02-22 12:49:10.17

d. In NP_ERROR_LOG (Need turn on it by adding SaveErrorLogInDatabase=True in appl.properties)
The error detail is as: Device connection time exceeds predefined threshold, device ID: NP002,connected at 2011-02-22 12:49:10.17

This connecion threshold can be specified in Appl.properties:
DeviceConnectionTimeThreshold
It is in minutes, the default value is 1440 (one day, for projects with persistent connection)

2. Record latest func call and SQL, detect and display whether it exceeds predefined threshold
The latest func call and SQL script, start time and end time are displayed in the user Tab of CA GUI

When the execution time exceeds the predefined threshold, the warning info will be displayed:
a. In CA exception report (a new report)
b. In Error.log (Need turn on it by adding SupportErrorLogFile=True in appl.properties)
c. In NP_ERROR_LOG (Need turn on it by adding SupportErrorLogFile=True in appl.properties)

This func call and SQL threshold can be specified in Appl.properties:
FunctionCallTimeThreshold
It is in minutes, the default value is 30

3. Combine all CA xml files (except Schedule.xml and Event.xml) and release note into one encrypted CommAgent.cfg,
The release note is named release.txt. Inside this file, you can specify the application release
and even specific TableSync or Transcation version if it is required
For example:
APP_Version=Nestle V3.0.1.2_20110222
TableSync_Version=Nestle V3.0.1.1
Transaction_Version=Nestle V3.0.1.2_20110222


The XML files and release file combination is done by a standalone application CfgTool.exe

The release info will be displayed:
a. In Comm Agent About page
b. In HTTP status report:
For example:
ACE Communication Agent V5.0.1.0-20110222 Status report

Application Version: Nestle V3.0.1.2_20110222

Server System Time: 22/02/2011 10:54:09

c. In CommAgentLive.txt file

Note:
For unregistered Comm Agent version, CA will open CommAgent.cfg first, if it is not found, CA will read current separated xml files and release.txt
For registered Comm Agent version, CA will only open CommAgent.cfg
This is to help developer to develop the XML files and also allow CA builder to open the XML files as usual.



Version : V5.0.0.6-20101201
Release to : Pepsico
Release date : 01/12/2010
Enhancements:
1. Catch and process the below exception
    java.lang.StringIndexOutOfBoundsException: String index out of range: 25
			at java.lang.String.checkBounds(String.java:402)
			at java.lang.String.<init>(String.java:570)
			at newspage.host.comm.NegACKHandler.a(Unknown Source)
			at newspage.host.comm.NegACKHandler.if(Unknown Source)
			at newspage.host.comm.NegACKHandler.handle(Unknown Source)
			at newspage.host.comm.d.for(Unknown Source)
			at newspage.host.comm.d.if(Unknown Source)
			at newspage.host.comm.d.run(Unknown Source)
			at java.lang.Thread.run(Thread.java:619)

Version : V5.0.0.6
Release to : QA,Jason,Shi Jing
Release date : 28/09/2010
Enhancements:
1. There is a issue reported in Danone Nutrition CN, which keeps recording ArrayIndexOutOfBoundsException
   //10-09-17 19:17:05 CommEngine.ProcessInbound: Handler is newspage.host.comm.MessageAckHandler
   //10-09-17 19:17:05 MessageAckHandler.ProcessMA: Got a MA packet from Gateway
   //10-09-17 19:17:06 CommEngine.run: Comm Engine Catched an error
   //10-09-17 19:17:06 java.lang.ArrayIndexOutOfBoundsException
   //10-09-17 19:17:06 CommEngine.run: Comm Engine Catched an error
   //10-09-17 19:17:06 java.lang.ArrayIndexOutOfBoundsException
   //10-09-17 19:17:06 CommEngine.run: Comm Engine Catched an error

   In case that gateway sent dummy data to CA, CA comm can log error and move to next message

   I fixed this issue in hostsocket.GetMessage

   Change the wireless comm version (in CommEngine.BgJob) to Version 3.01
2. Reduce repeat log
   For every 100 repeat, CA will only log one record and add “(Repeat 100 times)”  in front of the actual log
3. Turn off the "Reconnect to Gateway in the midnight"
4. For sent error code -12 from getway, CA will not send the message again until device goes online again
5. (Correction,previously the attribute is defined as 'B', but it conflicts with binary data from client) 
For blowfish encryption in transaction.xml. When client sends transaction data with certain fields encrypted by blowfish, we need specify the Attribute to ‘F’ for these fields
By this, CA will decrypt the data of these fields.
                        <DataSrc Name="CheckUser" Type="Client" Format="XML" Separator="\t">
                                    <Header Name="UserInfo">
                                                <Field Name="USER"></Field>
                                                <Field Name="PASSWORD" Attribute="F"></Field>
                                    </Header>
                        </DataSrc>



Version : V5.0.0.5
Release by : Zhong Hua
Release to : QA,PMI,Dannone 
Release date : 30/07/2010
Enhancements:
1. Because of the encryption DLL crash issues in PMI TH, I replace this DLL with pure Java 3DES encryption/decryption
2. Fix the NULL issue in event handling


Version : V5.0.0.4.20100721
Release by : Zhong Hua
Release to : QA,SPH
Release date : 21/07/2010
Enhancements:
1. Enhance user validation via directory service
	Return 2 session variables:
		s_UserAuthStatus:  1 means successful; 0 means failed
		s_UserAuthReason: can be below values
			User name or password is incorrect
			User is not found
			Account is disabled
			Account is expired
			Account is locked
			Denied access to computer via network
2. Support password change in directory service
	Add new before/after action: ChangePasswordInDirectoryServer
				<Before Action="ChangePasswordInDirectoryServer" URL="LDAP://10.21.232.100:636" UserID="CN=#USER#,CN=Users,DC=nps,DC=com" Type="SSL"
					Password="#PASSWORD#" Attribute="NewPassword=#NEW_PASSWORD#,CACertificate=#g_WorkDir#/cacerts" Condition="SQL:select 1 from M_USER where USER_ID='#USER#' AND CHECK_FLAG='A'" Scope="CurrentRecord" />


Version : V5.0.0.4.20100705
Release by : Zhong Hua
Release to : QA
Release date : 05/07/2010
Enhancements:
1. Enhance CA to support device list reload when the device ID is removed or locked in NP_Device table.
The removed device will not be included in CA license.

Version : V5.0.0.4.20100701
Release by : Zhong Hua
Release to : QA
Release date : 01/07/2010
Enhancements:
1. Fix the issue that CA directcomm receives duplicated message, but does not compose the message for application level
 

Version : V5.0.0.4.20100601
Release by : Zhong Hua
Release to : QA
Release date : 01/06/2010
Enhancements:
1.	Support blowfish encryption in transaction.xml. When client sends transaction data with certain fields encrypted by blowfish, we need specify the Attribute to ‘B’ for these fields
By this, CA will decrypt the data of these fields.
                        <DataSrc Name="CheckUser" Type="Client" Format="XML" Separator="\t">
                                    <Header Name="UserInfo">
                                                <Field Name="USER"></Field>
                                                <Field Name="PASSWORD" Attribute="B"></Field>
                                    </Header>
                        </DataSrc>

2.	Support user validation via directory service in CA “Before” and “After” call:
Action="AuthUserViaDirectoryServer"
URL="LDAP://10.21.232.100:636" – URL of directory server
Type="SSL"  -- only need specify for SSL
UserID="CN=#USER#,CN=Users,DC=NPTEST1,DC=newspage,DC=com"   -- CN of AD user
Password="#PASSWORD#"  -- password of AD user
Attribute="CACertificate=#g_WorkDir#/cacerts"  -- path of certificate file of SSL

You can put Condition to only authenticate certain group of users.

Below is a complete example of Transaction definition

            <Transaction Name="CheckUser" Type="RealTime" Action="Upload">
                        <DataSrc Name="CheckUser" Type="Client" Format="XML" Separator="\t">
                                    <Header Name="UserInfo">
                                                <Field Name="USER"></Field>
                                                <Field Name="PASSWORD" Attribute="B"></Field>
                                    </Header>
                        </DataSrc>
                        <DataDst Name="M_USER" Type="JDBC" Format="DEFAULT">
                                    <Header Name="M_USER">
                                                <Before Action="AuthUserViaDirectoryServer" URL="LDAP://10.21.232.100:636" UserID="CN=#USER#,CN=Users,DC=NPTEST1,DC=newspage,DC=com" Type="SSL"
Password="#PASSWORD#" Attribute="CACertificate=#g_WorkDir#/cacerts" Condition="SQL:select 1 from M_USER where USER_ID='#USER#' AND CHECK_FLAG='A'" Scope="CurrentRecord" />
                                    </Header>
                        </DataDst>
            </Transaction>


Version : V5.0.0.4-20100426
Release by : Zhong Hua
Release to : QA
Release date : 26/04/2010
Enhancements:
1.Added by Zhong Hua to date format conversion, the previous R5 CA engine does not support date format conversion

Version : V5.0.0.4-20100409
Release by : Zhong Hua
Release to : QA
Release date : 09/04/2010
Enhancements:
1.Added by Zhong Hua to support the packet size of direct comm configuration in comms.properties
  "DirectCommPacketSize", the default value is 1000
2.Change default value of SupportTableSyncDataCombination to False
3. Added by Ke Yong,2010-04-09,
  As reported by Lam Soon, the previous message is not inserted correctly because decompression fails

  10-03-26 08:06:47 4205 recv one D Pkt 1593,1,0
  10-03-26 08:06:47 Before AddPkts: Pkts == null true
  10-03-26 08:06:47 AddPkts: fileid D:/NewsPage/NPCommAgent/workdir/fileque/4205recv
  10-03-26 08:06:47 ProcessDataPkt:After AddPkt ret=2
  10-03-26 08:06:47 4205 can't decrypt or decompress message: source length is 866
  10-03-26 08:06:47 4205 processDataPkt:decompress or decrypt failed,will close socket
  10-03-26 08:06:47 4205 got exception in Recving socket closed
  10-03-26 08:06:47 4205--socket closed
  10-03-26 08:06:47 user 4205 exit

  10-03-26 08:06:58 4205 recv one D Pkt 1593,1,0
  10-03-26 08:06:58 Before AddPkts: Pkts == null true
  10-03-26 08:06:58 AddPkts: fileid D:/NewsPage/NPCommAgent/workdir/fileque/4205recv
  10-03-26 08:06:58 ProcessDataPkt:After AddPkt ret=-2
  10-03-26 08:06:58 4205 ProcessDataPkt:Send back ack(1593,1,0)
  So change the ProcessDataPkt of GcpUser.java, when receiving the duplicated message with pkt id == 0,
  will use the new data packet recieved.

Version : V5.0.0.3-20100223
Release by : Zhong Hua
Release to : Chian Hwa, QA
Release date : 25/02/2010
Enhancements:
1. Save error log into database
CA will automatically create a table called NP_ERROR_LOG to store all error activities

CREATE TABLE [dbo].[NP_ERROR_LOG](
	[RUN_NO] [uniqueidentifier] NOT NULL,
	[LOG_DT] [datetime] NULL,
	[MODULE_NAME] [varchar](100) NULL,
	[SUB_MODULE] [varchar](50) NULL,
	[ERROR_DESC] [nvarchar](2000) NULL,
	[PROCESS_STATUS] [varchar](10) NULL,
	[PROCESS_DT] [datetime] NULL,
 CONSTRAINT [PK_NP_ERROR_LOG] PRIMARY KEY CLUSTERED 
(
	[RUN_NO] ASC
)
)

The module name can be specified in Appl.properties, so as to support multiple Comm Agents to log the error into same table
ModuleName=CommAgentSG01

SUB_MODULE is the device ID

To turn on this feature, you need add below line in Appl.properties
SaveErrorLogInDatabase=True

2. Add a ScreenLogLevel in Appl.properties to control the log level in the UI



Version : V5.0.0.3
Release by : Zhong Hua
Release to : Shi Jing, Jor Wei,Chian Hwa, QA
Release date : 03/02/2010
Enhancements:
1. Performance enahncement:
To overcome the performance issue in Mapping function, a new feature is add to
automatically map the NULL value to blank in CA.
To turn on this feature, you need add below line into Appl.properties:

ConvertNullValuetoBlank=True

And you need remove all Mapping=”NULL|” from your configuration


Version : V5.0.0.2
Release by : Zhong Hua
Release to : Chian Hwa, QA
Release date : 22/12/2009
Enhancements:
1. Fix the issue on file downloading
In V5.0.0.1, CA cannot download files to client, there will be an error as
"Can not read file, its name is A" 

Please be noted that all V5 Comm Agent can run on JDK 1.5 and later version. Cannot run on JDK 1.4

This patch is only need for R5 Comm Agent. For all R3 Comm Agent releases, above issue does not happen

Version : V5.0.0.1
Release by : Zhong Hua
Release to : Internal testing
Release date : 01/12/2009
Enhancements:
1. Add the feature of combination of master data to provide better downloading communication perfromance.
This feature can be turned on by setting SupportTableSyncDataCombination=True in Appl.properties
CA application layer will combine the data based on the limit set in Appl.propeties
MaximumTableSyncDataSize=50
The size is in KB

Please be noted that all V5 Comm Agent can run on JDK 1.5 and later version. Cannot run on JDK 1.4


Version : V3.3.4.9
Release by : Zhong Hua
Release to : Jor Wei, QA
Release date : 16/03/2007
Enhancements:
1. Enhance the Log Level by adding 2 new Log Levels: LOG_INBOUND_DATA and LOG_OUTBOUND_DATA
So the new log format is:
Error	WARNING   EVENT   DATA   INBOUND_DATA   OUTBOUND_DATA   DEBUG
  1	   2	    4      8         16              32           64
This is to separate the inbound data (i.e. transaction) and outbound data (i.e. job) from normal data dump.
I.e. the LogLevel 23 means CA will log down the whole transaction data, but only log down
first 200 bytes of outgoing data.



Version : V3.3.4.8.20070308
Release by : Zhong Hua
Release to : Kwee Mui
Release date : 08/03/2007
Enhancements:
1. Add Condition into Before and After call, CA engine will check this condition and
decide whether it should call the before/after function.

The format of Condition can be:
a.  Based on SQL statement, the format is "SQL:" followed by a SQL statement
i.e. SQL: select status from j_job_item where status='P'

b. Based on file existing chekcing, the format is "FileExists:" followed by a file full path
i.e. FileExists:#g_WorkDir#\data\in_data_indicator 


Official Version : V3.3.4.8
Release by : Zhong Hua
Release to : QA
Release date : 16/01/2007
Enhancements:
Official release based on V3.3.4.7-20061127

Version : V3.3.4.7-20061127
Release by : Zhong Hua
Release to : FND
Release date : 27/11/2006
Enhancements:
1. Fix the decompression module which added the extra character wrongly in the end
of the decompressed transaction data. The extra charcter is binary code 1

Official Version : V3.3.4.7
Release by : Zhong Hua
Release to : FND
Release date : 07/11/2006
Enhancements:
1. Improve the multi-threading data separation module, in previous version,
if the DelayOfNewThread is set too short such as 2 seconds, data separation will stop
before completion. We recommend to set DelayOfNewThread to a value between 15 seconds to 2 minutes.


Version : V3.3.4.6-20061009 (Direct comm sub-module version is updated to 3.3.4.1.20061009)
Release by : Zhong Hua
Release to : GAB
Release date : 09/10/2006
Enhancements:
1. Fix a bug in CA direct communication which is casued by improper
socket read module, as result, the socket close signal (-1) is inserted into
data packet and cause crc error
2. fix a bug in CA direct communication which handles the duplicated packet (-1)
and unmatced message id (-2) worngly and cause the communication go into dead loop.


Version : V3.3.4.6-20061002
Release by : Zhong Hua
Release to : Shu Fan
Release date : 02/10/2006
Enhancements:
1. Fix a bug in job downloading module for Oracle database, in old engine,
job may not be downloaded sometimes.

Version : V3.3.4.6-20060728
Release by : Zhong Hua
Release to : General
Release date : 28/07/2006
Enhancements:
1. Change the Seprator default from '|' to '\t', this change should not affect
the projects in which we always sepcify the Separator. For exmaple,
    <Transaction Name="CheckUser" Type="RealTime" Action="Upload">
        <DataSrc Name="CheckUser" Type="Client" Format="XML" Separator="|">
            <Header Name="m_setup">

Separator is specified as '|' here.
However, pls double check the xml files before deploying this version.
2. Fix a bug which log the wrong sql statment in the Condition of DataSrc of Transaction
if the condition contains session varaibles
This bug does not impact the functionality as it only effect the log.
3. Fix a bug when CA download new release file which is in a corrupted zip file. Previous CA engine
will encounter a exception if the zip file is corrupted. 


Official Version : 3.3.4.6
Release by : Zhong Hua
Release to : General
Release date : 06/07/2006
Enhancements:
Same function as 3.3.4.5-20060705

Version : 3.3.4.5-20060705
Release by : Zhong Hua
Release to : General
Release date : 05/07/2006
Enhancements:
1. Fix a bug for the TableSync definition with TableSyncMethod="SimplyOverwrite" and AssembleMethod="UpdateRecord",
under this bug, AssembleMethod="UpdateRecord" will overwrite the TableSyncMethod to "UpdateByVersion"
The bug is due to the wrong handling which try to support both the old naming and new naming.

Under old naming, below values are supported 
Method : Refresh or Update
TableSyncMethod: SimplyOverwrite or UpdateByVersion
AssembleMethod: UpdateFieldByName or All -- All for all columns

Under new naming, below values are supported 
AssembleMethod: RefreshRecord,UpdateRecord or UpdateFieldByName
TableSyncMethod: SimplyOverwrite or UpdateByVersion

We encourgae to use the new naming although the old naming are still valid.

Upgrading information:
For most projects which are normally using old nameing method, this bug does not affect them.
For projects using new naming method, pls do a double check.

2. Fix a bug in 3.3.4.4-20060620, the default "SyncOperation<>'D'" has side-effort and sometimes
it may cause wrong condition by appending the "SyncOperation<>'D'". For example, if the condition includes
"compute" or "Order By", append the "SyncOperation<>'D'" will cause wrong SQL syntax. 

So now I filter the 'D' record only when I prepare the master data for client, not by adding the "SyncOperation<>'D'" into
the query condition, which is safe and does not impact the orginal query condition.

Upgrading information:

QA, pls alert projects using CA Version after 3.3.4.4-20060620 to be upgraded to this new version.
However, for CA before 3.3.4.4-20060620, it is not affected by this bug.



Official Version : 3.3.4.5-20060630
Release by : Zhong Hua
Release to : General
Release date : 30/06/2006

Enhancements:
1. Fix a bug that CA will record a non-harm exception when CA runs as service and user does
a manual data separation from Admin GUI
2. Add a session variable "s_HardwareID" to stand for the hardware ID 


Official Version : 3.3.4.5
Release by : Zhong Hua
Release to : General
Release date : 26/06/2006

Enhancements:
Same function as 3.3.4.4-20060621


Version : 3.3.4.4-20060621
Release by : Zhong Hua
Release to : General
Release date : 21/06/2006

Enhancements:
1. CA will automatically create the client detail table for MS SQL Server,
pls refer to Version (3.3.3, Build : 20030811-01) for more detail on client detail table.
2. Fix a bug in Device Manager, which will generate malformed sql statement if the same device logins again.



Version : 3.3.4.4-20060620
Release by : Zhong Hua
Release to : TW Police
Release date : 20/06/2006

Enhancements:
1. Fix a bug in Before call of DataDst Transaction definition, I.e.
      <DataDst Name="t_route_on" Type="JDBC" Format="DEFAULT">
           <Header Name="Int_Driver">
               <Before Action="SetSessionVariable" Name="u_MessageID" Value="'#g_TimeStamp#'" Scope="AllRecords" />
               <Field Name="MessageID" Value="'#u_MessageID#'" Type="Varchar" Attribute="P"></Field> 
The problem happens when u_MessageID is session which is set in Before call and used as the value of a primary key field.
When CA checks whether the records exists, it will use the old value of #u_MessageID#

2. Fix a bug in license checking: when device is deleted or locked, it is not removed from existing licensed user list
3. In refresh TableSync definition, if the TableSyncMethod is not "SimplyOverwrite",
new CA engine will automatically append the "SyncOperation<>'D'" into the query condition
i.e. where TableSyncMethod="UpdateByVersion", AssembleMethod="Refresh". 
However, if there is an existing condition which is related to SyncOperation, 
CA will not append "SyncOperation<>'D'"


Version : 3.3.4.4-20060619
Release by : Zhong Hua
Release to : TW Police
Release date : 19/06/2006

Enhancements:
1. Add the WaitForStatus after call, this function will be used to wait for third party application or our
DataBridge to get ready for the data which is to be sent to PDA.

For example, below function call will wait for 30 seconds until the statement after "SQL:" return value.
 <After Action="WaitForStatus" Value="SQL:select * from Int_Driver where MessageID='#u_MessageID#' and Processed='Y'"
                TimeOut="30" Scope="CurrentRecord" />
2. In Device Manager module, CA uses case-sensitive checking for device id/password.
3. Display Device Authentication Mode as the title of the Device Manager window


Version : 3.3.4.4-20060601
Release by : Zhong HUa
Release to : Nestle HK
Release date : 05/16/2006

Enhancements:
1. Fix the decompression module which added the ">" wrongly in the end
of the decompressed data


Version : 3.3.4.4-20060516
Release by : Zhong Hua
Release to : IDS SFA
Release date : 05/16/2006

Enhancements:
1. Add the unit item for data retention period in Setting dialog, the unit can be months or days

Version : 3.3.4.4-20060505
Release by : Ke Yong
Release to : Taiwan CHPost
Release date : 05/05/2006

Enhancements:
This release is specially for Taiwan CHPost only.
It is temporary version (V3.3.4.4-20060505) for CA, the DirectComm submodule version is (3.3.4.0.20060505).
Bug fixed:
- When the PDA client quit, the CA should not be notified that the pending msg can't be sent with error code -1 ( expired), it  should be notified with error code -7 (user quit).

---------------------------------------------------------------

Version : 3.3.4.3-20060403 (wireless Comm module version 1.18)
Release by : Zhong Hua
Release to : TW Post
Release date : 03/04/2006
Enhancements:
Fix a bug: 
The CA engine fails to load a parameter which is related to job downloading when CA engine starts as service, as the result of this bug, job cannot be downloaded when CA runs as service.

---------------------------------------------------------------
Version : 3.3.4.3 (wireless Comm module version 1.18)
Release by : Zhong Hua
Release to : Ciba Vision
Release date : 07/03/2006
Enhancements:
Same function as V3.3.4.2.20060222.

---------------------------------------------------------------

Version : V3.3.4.2.20060222
	 (Wireless Comm module version 1.18)
Release to : CibaVision
Release date : 27/02/2006
Enhancement
1. Fix a bug in wireless comm module, this bug may cause 2 wireless comm thread running at the same time. So at gateway side, 2 host sessions are trying to connect
to Gateway.

---------------------------------------------------------------

Version : 3.3.4.2
Release by : Zhong Hua
Release to : Jor Wei (Cemex)
Release date : 13/01/2006
Enhancements:
1. Fixed the problem that CA only start downloading master data after preparing all the data files in outbound table.

2. CA can purge the outgoing master data when client submit txn or do a new refresh/update via Direct Comm. This feature is configurable via a new parameter in Appl.Properties:
PurgePendingMessagesOnWiredReconnection=True


Other Details:
 Version:
   Gateway: 3.5.0.0, it is the standalone program, it is not the windows 
service version.
   NPWMCE.dll: 1.2.0.1
   There are 2 major enhancements in the longer term solution.
  1, Session restart flag is supported.  Everytime the user starts a 
communication , the session reset flag is sent to CA.
      During the data transferring, if the connection is broken, the dll 
will rebuild the connection and the session reset flag will NOT be sent 
to CA.
   2,  Hardware id is introduced. When the device sends 'I' packet to 
CA/GW , the hardware id is also sent.

 The  changes.
 1  CA will take over the all user authentication , so the user register 
dialog in Gateway is removed out.
 2  Client engine will interpret more error code, for example, "CA 
reaches max allowed user number " , "GW reaches max allowed user number" 
will report to client.

Compatibility.
   1. The new gateway can only compatted with new CA , whose version 
should be bigger than 3.3.4.1 20060103.
   2 .The new gateway can work with the old engine ,old NPWMCE.dll.
Gateway windows service version, sorry, it is still not completed.


----------------------------------------------------------------------

Version : 3.3.4.0.20051129
Release to :  CibaVision project
Release date : 29/11/2005
Enhancement
1.Add in unicode support.


Version : 3.3.3.9.20050825
New CA engine which supports multi-threaded Data Separation.
Enhanced for Cemex and want them to try it out first.


Version : 3.3.3.9.20050623
Release to : Chloe, Jor Wei (FND)
Release date : 23/06/2005
Enhancement
1. Fix the bug of transaction lost problem under DirectComm module when client lose connection during submitting transaction

Version : 3.3.3.9.20050520
Release to : Zoe (FDA)
Release date : 20/05/2005
Enhancement
1. Fix the bug of transaction lost problem under DirectComm module when database connection broken

Version : 3.3.3.9.20050227
Release to : Kah Hooi
Release date : 27/02/2005
Enhancement
1. Set maximum size of the transaction processing thread
2. Add QueuePollingInterval into Appl.Properties to set the queue polling interval when CA is idle

Release to : Kim Fang,Kah Hooi, Jor Wei, Chloe
Release date : 12/10/2004
Enhancement
1. Fix the bug which happen during the process of incoming transaction with UTF8 characters

Version : 3.3.3.8
Release to : Kim Fang,Kah Hooi, Jor Wei, Chloe
Release date : 12/10/2004
Enhancement
1. Fix the bug which happen during the process of incoming transaction with UTF8 characters

Version : 3.3.3.7.20040806
Release to : Kheng Wang for Securicor
Relkease date : 6/8/2004
Enhancement
1. Enhance the SignOn/Off process for Tracks

Version : 3.3.3.7
Release to : Kim Fang, Kah Hooi, Jor Wei, Chloe
Relkease date : 9/7/2004
Enhancement
1. Xml configuration reload
2. manually data separation for a group of users
3. Can configurate whether CA need download updated data followed by refresh data when client sends refresh request.
    Add below line in Appl.properties to turn off above feature:
    DownloadUpdateDataForRefreshRequest=False
4. Run as service


Version : 3.3.3.6.20040611
Release to : Kah Hooi, Jor Wei
Relkease date : 11/6/2004
Enhancement
1. Improve the performance of data separation

Version : 3.3.3.5
Release to : Kim Fang,Kah Hooi
Release date : 24/2/2003
Enhancement
1. Support Oracle database and Linux OS

Version : 3.3.3.4
Release to : Chian Hwa for Tracks FS
Release date : 12/12/2003

Version : 3.3.3.4
Official Release to : Kim Fang; Eddie
Release date : 26/11/2003

Version : 3.3.3.4.20031123
Release to : Jor Wei, Chloe
Release date : 24/11/2003
Enhancement:
1. Fine-tune the data separation process

Version : 3.3.3.4.20031030
Release to : Chloe,Eunice
Release date : 30/10/2003
Enhancement:
1. Fix a bug in comm module:
   Old Client may send some dummy data to CA which cause CA's comm module to insert wrong
data to USERLLI file and cause the comm module can not work.

Version : 3.3.3.4.20031030
Release to : Chloe
Release date : 29/10/2003
Enhancement:
1. Try to avoid and trace a bug in comm module by adding exception handling:
comm module may throw a exception in some api call, without capturing the exception,
it may interupt the CA running

Version : 3.3.3.3
Release to : Eddie
Release date : 7/10/2003
Enhancement:
1.Fix a bug in communication module of Comm Agent to work with new Gateway (V3.4.0.0, changed from V3.4.1.1)

Version : 3.3.3.2, for testing purpose only
Release to : Eddie
Release date : 30/9/2003
Enhancement:
1.Enhance communication module of Comm Agent to support new Gateway (V3.4.1.1)

Version : 3.3.3.1, Build : 20030919-01
Release to : Kwee Mui
Bug-fix:
1. Can not work with Client Comm Module (NPWCCE.dll Version 1.1.0.0)
when setting both compression and encryption in client admin dialog.
(Reason: CA wired comm does check the compression flag of 'I' packet,
always consider it as uncompression instead).
This bug does not happen if the client comm module is older than 1.1.0.0.


Official release
Version : 3.3.3.1, Release date : 2003-09-17
Release to : Eddie

Version : 3.3.3.1, Build : 20030909-01
Release to : Kah Hooi
Enhancement:
1. Simplify the device detail log activity as requested by Kah Hooi
2. change the FailedTxn folder structure as requested by Kah Hooi
   The new structure is as below:
	FailedTxn
	   |
	   ----- yyyymmdd (date)
		   |
		   ------ failed transaction files

Version : 3.3.3.1, Build : 20030828-01
Release to : Chloe and Choo Jun for Tempo project
Enhancement:
1. Update DB_PENDING table to allow DataBridge pick up changed job status and driver Sign On/Off message(It is configurable in xml files)

Version : 3.3.3.0, Build : 20030826-01
Release to : Kah Hooi
Bug-fix:
1. Previous version of CA expect client will indicate the separator inside the transaction packet
if the separator is not in default value(|). Now I change it to use the separator inside transaction.xml
of CA if the separator absents inside transaction packet.

Version : 3.3.3, Build : 20030818-01
Release to : Kah Hooi
Bug-fix:
1. The Redo module did not cater for other language besides English

Version : 3.3.3, Build : 20030811-01
Release to : Kah Hooi
Enhancement:
1. Add a "Data Separation" button in CA GUI to perform manual data separation
2. Insert device detail activity into database 
   To turn on this function, you need add below lines into appl.properties:
	LogClientDetailActivity = True
	ClientDetailActivityTable = O_CLTDETAIL
   Script to create this table:
	create table O_CLTDETAIL
	(DeviceID	varchar(20),
	Timestamp	datetime,
	Event	varchar(20),
	Activity varchar(50),
	Message varchar(200)

3. Save reject transactions into FailedTxn folder.


Version : 3.3.3, Build : 20030804-01
Release to : Siew Wai
Release this bug-fixed version for Siew Wai for Mobile Manager integration testing


Version : 3.3.3, Build : 20030724-01
Release to : Kah Hooi

Enhancement:
1. Save all the failed transactions into #WorkDir#/FailedTxns folder,
   failed transactions of different user are organized in a separated folder which name is same as user name,
   name of failed transaction is in yyyymmdd_hhmmss_index format
2. System administrator can move the failed transactions to #WorkDir#/Redo folder,
   and click the "Redo failed TXN" button in CA User Interface to redo the failed transaction
3. Fixed a sigle-quote bug in Transaction handling.   

